<h3 align="center">Onlymovies</h3>

---

## Description

A user-friendly movies web application enables users to effortlessly search for and view films. It's important to note that the actual playback feature is unavailable, as the movies are sourced from an external API. Users can efficiently filter movies by title, release date, and rating while also having the ability to like or unlike their preferred films. In addition to movie exploration, this application offers a variety of interactive games for leisurely entertainment, providing an engaging user experience.

Click <a href="https://github.com/liabilityquek/Movies_App_python">here</a> to view the backend repo.

## Timeframe

8 days

## Deployment

The application is deployed on Vercel. You would need to <a href="https://onlymovies-umber.vercel.app">create</a> an account to access the application.
The backend is deployed on <a href="https://movies-app-python.onrender.com">Render</a>.

## Features

<li>CRUD model on favourites, likes, game and subscription</li>
<li>Using RESTFul Routes</li>
<li>Error validation on both the client and the backend server</li>
<li>Adopt the MVC approach; Model, View and Controller</li>

## Technologies & Tools Used

<li><a href="https://github.com/liabilityquek/Movies_App_python">Flask</a></li>
<li>Javascript</li>
<li>Material UI</li>
<li>Git commands</li>
<li>React</li>
<li>Mongoose</li>
<li>Python</li>
<li>Vite</li>
<li>Moments</li>
<li>JWT</li>
<br>

## Wireframe</a>

<li>Login form</li>
<li>Sign Up Page</li>
<li>Forget Password</li>
<li>Logout button</li>
<li>Page to show user's favourite movies</li>
<li>Page to show trending movie search</li>
<li>Page to view my account status</li>
<li>Page to view my games for playing</li>
<li>Page to create, amend and delete games</li>
</li>
<br>

## User Stories</a>

<li>As a new user, I want to sign up for the application using my name, email, and password, so that I can access the movie recommendation feature.</li>
<li>As an existing user, I want to log in to the application with my email and password, so that I can access my personalized movie favourites.</li>
<li>As a logged-in user, I want to search for a movie using keywords or phrases, so that the application can provide relevant movie recommendations.</li>
<li>As a logged-in user, I want to see a list of trending movie searches that include the movie title, poster, description, and rating, so that I can make an informed decision about what to watch.</li>
<li>As a logged-in user, I want to log out of the application, so that my account is secure when I am not using it.</li>
<li>As a logged-in user, I want to be able to cancel/reinstate/amend my subscription plans.</li>
<li>As a logged-in user, I want to be able to access to different games for leisure playing.</li>
<li>As a logged-in admin user, I want to be able to create, amend and delete games.</li>
<li>As a logged-in admin user, I want to log out of the application, so that my account is secure when I am not using it.</li>
<br>

## Data Model</a>

<br>
 <p align="center">
  <a href="" rel="noopener">
 <img style="max-width: 100%;" src="/images/data model.png" alt="data model"></a>
</p>

## Login/Forget/Reset</a>

<br>
 <p align="center">
  <a href="" rel="noopener">
 <img style="max-width: 100%;" src="/images/login.png" alt="Login"></a>
</p>
<br>
 <p align="center">
  <a href="" rel="noopener">
 <img style="max-width: 100%;" src="/images/forget password.png" alt="Forget Password"></a>
</p>
<br>
 <p align="center">
  <a href="" rel="noopener">
 <img style="max-width: 100%;" src="/images/new user.png" alt="Create User"></a>
</p>

## User - Customer</a>

<br>
 <p align="center">
  <a href="" rel="noopener">
 <img style="max-width: 100%;" src="/images/home.png" alt="home"></a>
</p>
<br>
 <p align="center">
  <a href="" rel="noopener">
 <img style="max-width: 100%;" src="/images/adding to favourites.png" alt="adding to favourites"></a>
</p>
<br>
 <p align="center">
  <a href="" rel="noopener">
 <img style="max-width: 100%;" src="/images/account.png" alt="account"></a>
 <br>
 <p align="center">
  <a href="" rel="noopener">
 <img style="max-width: 100%;" src="/images/amend subscription.png" alt="amend subscription"></a>
 <br>
 <p align="center">
  <a href="" rel="noopener">
 <img style="max-width: 100%;" src="/images/cancel subscription with trial.png" alt="cancel subscription with trial"></a>
  <br>
 <p align="center">
  <a href="" rel="noopener">
 <img style="max-width: 100%;" src="/images/cancel subscription.png" alt="cancel subscription"></a>
  <br>
 <p align="center">
  <a href="" rel="noopener">
 <img style="max-width: 100%;" src="/images/delete favourites.png" alt="delete favourites"></a>
   <br>
 <p align="center">
  <a href="" rel="noopener">
 <img style="max-width: 100%;" src="/images/directing to the game site.png" alt="directing to game site"></a>
   <br>
 <p align="center">
  <a href="" rel="noopener">
 <img style="max-width: 100%;" src="/images/favourites filter.png" alt="favourites filter"></a>
</p>
   <br>
 <p align="center">
  <a href="" rel="noopener">
 <img style="max-width: 100%;" src="/images/games.png" alt="games"></a>
</p>
   <br>
 <p align="center">
  <a href="" rel="noopener">
 <img style="max-width: 100%;" src="/images/view trending search results.png" alt="trending search results"></a>
</p>

## User - Admin</a>

 <p align="center">
  <a href="" rel="noopener">
 <img style="max-width: 100%;" src="/images/admin.png" alt="admin page"></a>
</p>
<br>
 <p align="center">
  <a href="" rel="noopener">
 <img style="max-width: 100%;" src="/images/amend game details.png" alt="amending game details"></a>
</p>
<br>

## Deliverables Timeline

<strong><u>Day 1:</u></strong>

<li>Writing up user stories, wireframe and data model</li>
<li>Setting up Flask</li>
<li>Reading Flask documentation</li>
<br>
<strong><u>Day 2:</u></strong>
<li>Setting up Flask</li>
<li>Reading Flask documentation</li>
<br>
<strong><u>Day 3:</u></strong>
<br>
<li></li>
<li>Writing up the data model and routes in python</li>
<li>Testing backend using Postman</li>
<li>Working on React components</li>
<br>
<strong><u>Day 4:</u></strong>
<br>
<li>Working on React components</li>
<br>
<strong><u>Day 5:</u></strong>
<br>
<li>Working on React components</li>
<br>
<br>
<strong><u>Day 6:</u></strong>
<br>
<li>Working on React components</li>
<br>
<br>
<strong><u>Day 7:</u></strong>
<br>
<li>Working on React components</li>
<li>Re-work on data model to cater for subscription</li>
<li>Working on subscription dates</li>
<br>
<strong><u>Day 8:</u></strong>
<br>
<li>Working on React components</li>
<li>Wrap up</li>
<br>

## Key Takeaways

These are key takeaways when working on the project:

<li>Separate key requirements of the project and "nice to have"</li>
<li>Research early when working on new framework</li>
<li>Assign meaningful name to functions for easy readability</li>
<li>Using the MVC approach to keep codes organised</li>

<br>

<strong><u>Using a useCallback hook to memorize a function(which in this case would be the onGameUpdated), preventing it from being re-created on every render of a component.</u></strong>

```js
//Parent Component
const Games = ({ userName, setUser }) => {
  const [games, setGames] = useState([]);
  const token = localStorage.getItem("token");
  const id = JSON.parse(window.atob(token.split(".")[1]));
  const userId = id.sub.id
  const [isLoading, setIsLoading] = useState(true);
  const { refreshToken }  = useRefresh();


  const fetchGames = useCallback(async (authToken) => {

    try {
      const response = await axios.get(`https://movies-app-python.onrender.com/showgames/${userId}`, {
        headers: {
          Authorization: `Bearer ${authToken}`,
        },
      });

      setGames(response.data.games);
      setIsLoading(false);
    } catch (error) {
      console.log(error);
        const newToken = await refreshToken();
        console.log("New token:", newToken);
        await fetchGames(newToken);

    }
  }, [userId, refreshToken]);

  const handleGameUpdated = () => {
    fetchGames();
  };

  useEffect(() => {
    fetchGames(token);
  }, []);

  if (isLoading) {
    return <Loading/>;
  }

  return (
    <>
      <Bar setUser={setUser}/>
      <Typography
        component="h1"
        variant="h5"
        align="center"
        color="text.primary"
        gutterBottom
        sx={{ color: "white", marginTop: 4 }}
      >
        Welcome back, {userName}
      </Typography>
      <GameGrid itemsPerPage={9} games={games} onGameUpdated={handleGameUpdated} />
    </>
  );
};

export default Games;

//Child Component

export default function GameGrid({ itemsPerPage, games, onGameUpdated, isLoading }) {
  const [page, setPage] = useState(1);
  const [sort, setSort] = useState("");
  const [likesCount, setLikesCount] = useState([]);


  const handleChange = (event, value) => {
    setPage(value);
  };

  const sortHandleChange = (e) => {
    setSort(e.target.value);
  };

  useEffect(() => {
    setLikesCount(games.map(game => game.likes ? game.likes.length : 0));
  }, [games]);

  const handleLikeChange = (index, increment) => {
    setLikesCount(likesCount.map((count, i) => i === index ? count + increment : count));

  };

  const sortOption = () => {
    return games
      .map((game, index) => ({ ...game, likesCount: likesCount[index] }))
      .sort((a, b) => {
        switch (sort) {
          case "title":
            return a.title.localeCompare(b.title, { ignorePunctuation: true });
          case "likes":
            return a.likesCount - b.likesCount;
          default:
            return 0;
        }
      });
  };


  return (
    <div>
      {isLoading ? (
        <Loading />
      ) : (
        <>
          <Box
            marginRight={4}
            sx={{ display: "flex", justifyContent: "flex-end" }}
          >
            <FormControl variant="standard" sx={{ m: 1, minWidth: 120 }}>
              <InputLabel
                id="sort-label"
                sx={{ "&.MuiInputLabel-root": { color: "white" } }}
              >
                Sort by
              </InputLabel>
              <Select
                labelId="sort-label"
                value={sort}
                onChange={sortHandleChange}
                label="Sort by"
                sx={{ bgcolor: "grey", borderRadius: 1 }}
              >
                <MenuItem value="title">Title</MenuItem>
                <MenuItem value="likes">Likes</MenuItem>
              </Select>
            </FormControl>
          </Box>

          <Grid container spacing={2}>
            {sortOption()
              .slice((page - 1) * itemsPerPage, page * itemsPerPage)
              .map((game, index) => {
                console.log(
                  `likes in GameGrid for game ${game.title}: ${game.likesCount}, ${JSON.stringify(game, null, 2)}`
                );
                return (
                  <Grid item xs={12} sm={6} md={4} key={index}>
                    <GameCard
                      games={game}
                      likes={game.likesCount}
                      handleLikeChange={(increment) =>
                        handleLikeChange(games.indexOf(game), increment)
                      }
                      onGameUpdated={onGameUpdated}
                    />
                  </Grid>
                );
              })}
          </Grid>

          <Pagination
            count={Math.ceil(games.length / itemsPerPage)}
            page={page}
            onChange={handleChange}
            sx={{
              mt: 4,
              display: "flex",
              justifyContent: "center",
              "& .MuiPaginationItem-root": {
                color: "white",
              },
            }}
          />
          {games.length === 0 && (
            <Typography
              variant="h6"
              color="white"
              sx={{ mt: 4, textAlign: "center" }}
            >
              Nothing to show..
            </Typography>
          )}
        </>
      )}
    </div>
  );

}

```

<br>

<strong><u>Using Debounce to set a timeout of 1s in my search bar:</u></strong>

```js
import { DebounceInput } from "react-debounce-input";
<DebounceInput
  placeholder="Search…"
  inputProps={{ "aria-label": "search" }}
  onChange={handleSearch}
  debounceTimeout={1000}
  element={StyledInputBase}
/>;
```

<br>

<strong><u>Refreshing JWT Token using Flask</u></strong>

```py
# app.py
@app.route('/refresh', methods=['POST'])
@jwt_required(refresh=True)
def refresh_token():
    return loginController.refresh()

# loginController

def login(request, bcrypt):
    try:

        email = request.json.get('email')
        password = request.json.get('password')
        selected_role = request.json.get('role')


        if len(password) < 3:
            raise ValueError("Password too short")

        user = User.objects(email=email).first()
        if not user:
            raise ValueError("Login Credentials does not exist")

        if user.role != selected_role:
            raise ValueError("Invalid role for this email")

        if bcrypt.check_password_hash(user.password, password):
            # Set the expiration time to 30 minutes
            token = create_access_token(identity={"email": email, "role": user.role, "id": str(user.id), "name": user.name}, expires_delta=timedelta(minutes=30))
            refresh_token = create_refresh_token(identity={"email": email, "role": user.role, "id": str(user.id), "name": user.name})
            print("Generated access_token:", token)
            print("Generated refresh_token:", refresh_token)
            return jsonify({"token": token, "customer": user, "refresh_token": refresh_token}), 200

    except ValueError as ve:
        response = jsonify({"error": str(ve)})
        response.status_code = 400
        return response

def refresh():
    current_user = get_jwt_identity()
    token = create_access_token(identity=current_user, expires_delta=timedelta(minutes=15), fresh=False)
    print("Generated token in refresh():", token)
    return jsonify({"token": token}), 200
```

<strong><u>Configuring refreshing JWT Token in React</u></strong>

```js
import { useState, useEffect } from "react";
import axios from "axios";

export function useRefresh() {
  const [user, setUser] = useState(null);

  const refreshToken = async () => {
    console.log(`calling refreshToken`);
    try {
      const response = await axios.post(
        `https://movies-app-python.onrender.com/refresh`,
        null,
        {
          headers: {
            Authorization: `Bearer ${localStorage.getItem("refresh_token")}`,
          },
        }
      );

      localStorage.setItem("token", response.data.token);

      return response.data.token;
    } catch (error) {
      console.error("Error refreshing token:", error);
      return null;
    }
  };

  useEffect(() => {
    const checkTokenExpiration = async () => {
      const token = localStorage.getItem("token");

      if (token) {
        try {
          const decodedToken = JSON.parse(window.atob(token.split(".")[1]));

          if (decodedToken.exp * 1000 < Date.now()) {
            await refreshToken();
          }
        } catch (error) {
          console.error("error refreshing token: ", error);
        }
      }
    };

    checkTokenExpiration();
  }, []);

  return { user, setUser, refreshToken };
}
```

## Future Enhancements

<p>As this application is part of a project submission, there would not be an future amendments made to this.</p>However, if there were any future enhancements to be made, these would be the following changes:</p>
<li>Insert a Stripe payment gateway</li>
<li>Using OAuth</li>

<br>
## References
Various sources which I have seek guidance from:
</li>
<li><a href=https://www.npmjs.com/package/react-material-ui-carousel>Material UI Carousel</a>
</li>
<li><a href=https://dev.to/nagatodev/how-to-connect-flask-to-reactjs-1k8i>How to connect flask to reactjs</a>
</li>
<li><a href=https://flask-bcrypt.readthedocs.io/en/1.0.1>Flask Bcrypt</a>
</li>
<li><a href=https://www.geeksforgeeks.org/python-try-except>Python try except</a>
</li>
<li><a href=https://flask-cors.readthedocs.io/en/latest>Configuring Flask CORS</a>
</li>
<li><a href=https://rest-apis-flask.teclado.com/docs/flask_jwt_extended/token_refreshing_flask_jwt_extended>Token resfreshing Flask JWT Extended</a>
</li>
<li><a href=https://developers.themoviedb.org/3/getting-started/introduction>External API for movies database</a>
</li>
<br>

## Application Asset Attribution

The CSS in this project does not belong to me. All rights belong to the original artists and owners. Below are the links to the CSS used in this project:

<li><a href=https://icons8.com/icons/set/movie>Movie Icon</a>
</li>
<li><a href=https://www.freeiconspng.com/downloadimg/23500>Not available image</a>
</li>
